{
  "dfe": [
    {
      "name": "root",
      "type": "div-r",
      "_get": "[$$]",
      "attributes": "{class : 'div-flex', rowclass : 'div-flex-row', rowstyle: 'border: 1px solid; border-color: darkgray; border-radius: 5px; width: min-content; width: -moz-min-content;', rowstyle$header : 'display: table', rowclass$footer : 'div-flex-row', rowstyle$footer : 'flex-wrap: wrap; width: 800px;'}"
    },
    {
      "name": "add_dfe",
      "parent": "root",
      "type": "button",
      "class": "header",
      "_get": "'+'",
      "_set": "var root = $$('dfe')[0].data; $$.form.changeParent(root.form.registerFields([{name: $$.form.generateName($$), type: 'editbox', _get: '[$$]'}])[0], $$('childrenOf') == 0 ? root.name : $$('childrenOf'))",
      "dpos": {
        "colstyle": "display: inline; height: min-content;"
      }
    },
    {
      "name": "l1",
      "parent": "root",
      "type": "label",
      "class": "header",
      "_get": "'Show only children of: '",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; "
      }
    },
    {
      "name": "childrenOf",
      "parent": "root",
      "type": "dropdown",
      "class": "header",
      "_get": "{ value: $$('childrenOf'), items: [{ value : [], description : 'All'}].concat($$('dfe').filter(function(px) { return px.get('.children') != 0}).map(function(px) { return px.get('.name')}).sort().map(function(s) { return { value : s}})) }",
      "_set": "$$.set('hierarchyOf', []); $$.set('childrenOf', $$.value)",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; "
      }
    },
    {
      "name": "subChildren",
      "parent": "root",
      "type": "checkbox",
      "class": "header",
      "_get": "{ checked: $$('subChildren'), text: ''}",
      "_set": "$$.set('subChildren', $$.value)",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; "
      }
    },
    {
      "name": "l2",
      "parent": "root",
      "type": "label",
      "class": "header",
      "_get": "'Show hierarchy: '",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; "
      }
    },
    {
      "name": "hierarchyOf",
      "parent": "root",
      "type": "dropdown",
      "class": "header",
      "_get": "{ value: $$('hierarchyOf'), items: [{ value : [], description : 'All'}].concat($$('dfe').map(function(px) { return px.get('.name')}).sort().map(function(s) { return { value : s}})) }",
      "_set": "$$.set('childrenOf', []); $$.set('hierarchyOf', $$.value)",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; "
      }
    },
    {
      "name": "append_css",
      "parent": "root",
      "type": "button",
      "_get": "'Custom CSS:'",
      "class": "header",
      "_set": "$$.form.pushCSStoPage($$('css'), 'custom-css-dfe')",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; height: min-content;"
      }
    },
    {
      "name": "css_text",
      "parent": "root",
      "type": "editbox-code",
      "_get": "$$('css')",
      "class": "header",
      "_set": "$$.set('css', value)",
      "attributes": "{ class: 'focus-front', trigger : 'change', style: 'width: 100px;', ta: { style: 'width: 1070px; height: 400px;', lang: 'css', offsetLeft: -200, 'class': 'popup-editor-wrapper' } }",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; "
      }
    },      
    {
      "name": "Pretty-print",
      "parent": "root",
      "type": "button",
      "_get": "'Pretty-print'",
      "class": "header",
      "_set": "$$.runtime.notifyControls($$.runtime.findControls('pp_output'), 'pp')",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; height: min-content;"
      }
    },
    {
      "name": "Raw",
      "parent": "root",
      "type": "button",
      "_get": "'Raw'",
      "class": "header",
      "_set": "$$.runtime.notifyControls($$.runtime.findControls('pp_output'), 'p')",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; height: min-content;"
      }
    },
    {
      "name": "load",
      "parent": "root",
      "type": "button",
      "_get": "'Load JSON'",
      "class": "header",
      "_set": "$$.form.setTargetDfe($$, JSON.parse($$.runtime.findControls('pp_output')[0].ui.value))",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; height: min-content;"
      }
    },
    {
      "name": "pp_output",
      "parent": "root",
      "type": "editbox-P",
      "_get": "($$.events[0]||{}).action=='pp' ? JSON.stringify($$.form.forPrinting($$.withListener(0)), null, 2) : JSON.stringify($$.form.forPrinting($$.withListener(0)))",
      "class": "header",
      "attributes": "{ class: 'focus-front', trigger : 'change', style: 'width: 100px;', ta: { style: 'width: 1070px; font-size: 14px; height: 400px;', lang: 'json', offsetLeft: -500, 'class': 'popup-editor-wrapper' } }",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; "
      }
    },
    {
      "name": "ARF",
      "parent": "root",
      "type": "button",
      "_get": "'ARF'",
      "class": "header",
      "_set": "$$.runtime.notifyControls($$.runtime.findControls('pp_output'), 'pa')",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; height: min-content;"
      }
    },      
    {
      "name": "validate",
      "parent": "root",
      "type": "button",
      "_get": "'Simulate validation'",
      "class": "header",
      "_set": "$$.form.validateTarget($$)",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; height: min-content;"
      }
    },
    {
      "name": "restart",
      "parent": "root",
      "type": "button",
      "_get": "'Restart target'",
      "class": "header",
      "_set": "$$.form.restartTarget($$)",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; height: min-content;"
      }
    },
    {
      "name": "funcs",
      "parent": "root",
      "type": "editbox-code",
      "_get": "$$('setup')",
      "_set": "$$.set('setup', value)",
      "class": "header",
      "validation": "try { Function($$('setup')).call({}) } catch(e) { console.error(e); $$.error('Compilation error') }",
      "attributes": "{ vstrategy: 'always', class: 'focus-front', style: 'width: 100px;', eclass : 'editbox-error', ta: { func : { of: 'DfeForm', name: 'setup' }, style: 'width: 1070px; height: 400px;', offsetLeft: -820, 'class': 'popup-editor-wrapper', eclass : 'popup-code-editor-erroring'} }",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; "
      }
    },
    {
      "name": "push2srv",
      "parent": "root",
      "type": "button",
      "_get": "'Store in session'",
      "class": "header",
      "_set": "$$.form.storeInSession($$)",
      "dpos": {
        "colstyle": "display: inline; margin-left: 2px; height: min-content;"
      }
    },
    {
      "name": "dfe_row",
      "parent": "root",
      "type": "div-c",
      "_get": "$$('dfe')",
      "attributes": "{ filter: $$.form.getFieldList($$, $$('childrenOf'), $$('hierarchyOf'), $$('subChildren')), class : 'div-flex-h', style: 'box-sizing: border-box; overflow-y: scroll; height: 400px;', rowclass$header : 'div-alt-color-fc', orientation: 'horizontal', events: { mouseover: $$.form.highlightField, mouseleave: $$.form.highlightField } }",
      "dpos": {
        "colclass": "div-flex-col",
        "colstyle" : "margin: 0px; padding: 0px; width: max-content; width: -moz-max-content;"
      }
    },
    {
      "name": "up_field_h",
      "parent": "dfe_row",
      "type": "label",
      "class": "header",
      "_get": "'x'",
      "attributes": "{style : 'visibility:hidden'}",
      "dpos": {
        "colclass": "div-flex-col -sticky-header",
        "colstyle": "border-top-left-radius: 3px;"
      }
    },
    {
      "name": "name_field_h",
      "parent": "dfe_row",
      "type": "label",
      "class": "header",
      "_get": "'Field name'",
      "dpos": {
        "colclass": "div-flex-col -sticky-header"
      }
    },
    {
      "name": "parent_field_h",
      "parent": "dfe_row",
      "type": "label",
      "class": "header",
      "_get": "'Parent'",
      "dpos": {
        "colclass": "div-flex-col -sticky-header"
      }
    },
    {
      "name": "type_field_h",
      "parent": "dfe_row",
      "type": "label",
      "class": "header",
      "_get": "'Type'",
      "dpos": {
        "colclass": "div-flex-col -sticky-header"
      }
    },
    {
      "name": "get_field_h",
      "parent": "dfe_row",
      "type": "label",
      "class": "header",
      "_get": "'Getter'",
      "dpos": {
        "colclass": "div-flex-col -sticky-header"
      }
    },
    {
      "name": "set_field_h",
      "parent": "dfe_row",
      "type": "label",
      "class": "header",
      "_get": "'Setter'",
      "dpos": {
        "colclass": "div-flex-col -sticky-header"
      }
    },
    {
      "name": "val_field_h",
      "parent": "dfe_row",
      "type": "label",
      "class": "header",
      "_get": "'Validation'",
      "dpos": {
        "colclass": "div-flex-col -sticky-header"
      }
    },
    {
      "name": "attr_field_h",
      "parent": "dfe_row",
      "type": "label",
      "class": "header",
      "_get": "'Attributes'",
      "dpos": {
        "colclass": "div-flex-col -sticky-header"
      }
    },
    {
      "name": "del_field_h",
      "parent": "dfe_row",
      "type": "label",
      "class": "header",
      "_get": "'Del.'",
      "dpos": {
        "colclass": "div-flex-col -sticky-header",
        "colstyle": "margin-bottom: 0px;"
      }
    },
    {
      "name": "class_field_h",
      "parent": "dfe_row",
      "type": "label",
      "class": "header",
      "_get": "'Class'",
      "dpos": {
        "colclass": "div-flex-col -sticky-header",
        "colstyle": "margin-bottom: 0px;"
      }
    },
    {
      "name": "ppos_field_h",
      "parent": "dfe_row",
      "type": "label",
      "class": "header",
      "_get": "'Layout specific'",
      "attributes": "{ style : 'white-space: nowrap;' }",
      "dpos": {
        "colclass": "div-flex-col -sticky-header",
        "colstyle": "border-top-right-radius: 3px;margin-bottom: 0px;"
      }
    },
    {
      "name": "field_up",
      "parent": "dfe_row",
      "type": "editbox",
      "_get": "$$.index() /*{ value: $$.index(), items: $$.get('..dfe').map(function(o, n) { return {value: n}}).slice(1) }*/",
      "_set": "$$.form.moveField($$, value)",
      "attributes": "{ events: { focus: function(e,c) {c.ui.setSelectionRange(0, 99)}}, trigger : 'change', style : $$.index() ? '' : 'visibility:hidden;', class: 'editor-pos-fld' }",
      "dpos": {
        "colclass": "div-flex-col editbox-col --hover-visible"
      }
    },
    {
      "name": "name_field",
      "parent": "dfe_row",
      "type": "editbox",
      "_get": "$$('.name')",
      "_set": "$$.form.changeName($$, value)",
      "dpos": {
        "colclass": "div-flex-col"
      }
    },
    {
      "name": "parent_field",
      "parent": "dfe_row",
      "type": "dropdown",
      "_get": "{ value : $$('.parent'), items :  $$('dfe').filter(function(px) { return px.get('.component').isContainer}).map(function(px) { return px.get('.name')}).sort().map(function(s) { return {value : s}})}",
      "_set": "$$.form.changeParent($$, value)",
      "attributes": "{ style : $$('.parent') == 0 ? 'visibility:hidden;' : ''}",
      "dpos": {
        "colclass": "div-flex-col"
      }
    },
    {
      "name": "type_field",
      "parent": "dfe_row",
      "type": "dropdown",
      "_get": "i=[], $$.form.components.forEach(function(v,k) {i.push(k)}), { value : $$('.type'), items : i.sort().map(function(s) { return  { value : s}})}",
      "_set": "$$.form.changeType($$, value)",
      "dpos": {
        "colclass": "div-flex-col editbox-col"
      }
    },
    {
      "name": "get_field",
      "parent": "dfe_row",
      "type": "editbox-code",
      "_get": "$$('._get')",
      "_set": "$$.set('._get', value); $$.form.fixFunctions($$, true)",
      "attributes": "{ style : 'margin: 0px', spellcheck: 'false', vstrategy : 'always', eclass : 'editbox-error', ta: { func: { name: 'get', ret: 1, args: ['$$'], cmnt: '$$.result(<message>) for async rendering'}, offsetLeft: -100, 'class': 'popup-editor-wrapper', eclass : 'popup-code-editor-erroring'}}",
      "validation": "$$('.get') == compilationerror && $$.error('Compilation error')",
      "dpos": {
        "colclass": "div-flex-col"
      }
    },
    {
      "name": "set_field",
      "parent": "dfe_row",
      "type": "editbox-code",
      "_get": "$$('._set')",
      "_set": "$$.set('._set', value); $$.form.fixFunctions($$, true)",
      "attributes": "{ style : 'margin: 0px', spellcheck: 'false', vstrategy : 'always', eclass : 'editbox-error', ta: { func: { name: 'set', args: ['$$', 'value']}, offsetLeft: -100, 'class': 'popup-editor-wrapper', eclass : 'popup-code-editor-erroring'}}",
      "validation": "$$('.set') == compilationerror && $$.error('Compilation error')",
      "dpos": {
        "colclass": "div-flex-col"
      }
    }, 
    {
      "name": "val_field",
      "parent": "dfe_row",
      "type": "editbox-code",
      "_get": "$$('.validation')",
      "_set": "$$.set('.validation', value); $$.form.fixFunctions($$, true)",
      "attributes": "{ style : 'margin: 0px', spellcheck: 'false', vstrategy : 'always', eclass : 'editbox-error', ta: { func: { name: 'validate', args: ['$$'], cmnt: '$$.error(<message>) to fail validation'}, offsetLeft: -100, 'class': 'popup-editor-wrapper', eclass : 'popup-code-editor-erroring'}}",
      "validation": "$$('.val') == compilationerror && $$.error('Compilation error')",
      "dpos": {
        "colclass": "div-flex-col"
      }
    },
    {
      "name": "attr_field",
      "parent": "dfe_row",
      "type": "editbox-code",
      "_get": "$$('.attributes')",
      "_set": "$$.set('.attributes', value); $$.form.fixFunctions($$, true)",
      "attributes": "{ style : 'margin: 0px', spellcheck: 'false', vstrategy : 'always', eclass : 'editbox-error', ta: { func: { name: 'attr', ret: 1, args: ['$$'] }, offsetLeft: -100, 'class': 'popup-editor-wrapper', eclass : 'popup-code-editor-erroring'}}",
      "validation": "$$('.atr') == compilationerror && $$.error('Compilation error')",
      "dpos": {
        "colclass": "div-flex-col"
      }
    },
    {
      "name": "field_del",
      "parent": "dfe_row",
      "type": "button",
      "_get": "'X'",
      "_set": "$$.form.delete($$)",
      "attributes": "{ style : ($$('.parent') == 0 ? 'visibility:hidden;' : '') + 'padding-bottom: 0px; padding-top: 0px;'}",
      "dpos": {
        "colclass": "div-flex-col editbox-col"
      }
    },
    {
      "name": "class_field",
      "parent": "dfe_row",
      "type": "dropdown",
      "_get": "{ value : $$('.class'), items: [ '', 'header', 'footer' ] }",
      "_set": "$$.set('.class', value); $$.form.changeTPos($$)",
      "attributes": "{ style : $$('.parent') == 0 ? 'visibility:hidden;' : ''}",
      "dpos": {
        "colclass": "div-flex-col editbox-col"
      }
    },
    {
      "name": "layout_spec_ctrl",
      "parent": "dfe_row",
      "type": "div",
      "_get": "[$$]",
      "attributes": "{ style : 'padding:0px 1px 0px 1px; display: flex; flex-direction: row;'}"
    },
    {
      "name": "tpos_ctrl",
      "parent": "layout_spec_ctrl",
      "type": "div",
      "_get": "getContainerLayout($$) == 'tpos' ? [$$] : []",
      "attributes": "{ class : 'div-flex-row' }",
      "dpos": {
        "colclass": "div-flex-col-embedded-1"
      }
    },
    {
      "name": "tpos_col_w",
      "parent": "tpos_ctrl",
      "type": "label",
      "_get": "'Width:'",
      "dpos": {
        "colclass": "div-flex-col-embedded"
      }
    },
    {
      "name": "tpos_field_w",
      "parent": "tpos_ctrl",
      "type": "dropdown",
      "_get": "{ value : $$('.tpos').w, items: ['', 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]}",
      "_set": "$$.form.changeTPos($$, $$.value)",
      "dpos": {
        "colclass": "div-flex-col-embedded"
      }
    },
    {
      "name": "tpos_col_h",
      "parent": "tpos_ctrl",
      "type": "label",
      "_get": "'Height:'",
      "dpos": {
        "colclass": "div-flex-col-embedded"
      }
    },      
    {
      "name": "tpos_field_h",
      "parent": "tpos_ctrl",
      "type": "dropdown",
      "_get": "{ value : $$('.tpos').h, items: ['', 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]}",
      "_set": "$$.form.changeTPos($$, undefined, $$.value)",
      "dpos": {
        "colclass": "div-flex-col-embedded"
      }
    },   
    {
      "name": "tpos_field_n",
      "parent": "tpos_ctrl",
      "type": "checkbox",
      "_get": "{ checked: $$('.tpos').n, text: '<'}",
      "_set": "$$.form.changeTPos($$, undefined, undefined, $$.value)",
      "dpos": {
        "colclass": "div-flex-col-embedded"
      }
    },
    {
      "name": "tpos_field_s",
      "parent": "tpos_ctrl",
      "type": "editbox",
      "_get": "$$('.tpos').s",
      "_set": "$$.form.changeTPos($$, undefined, undefined, undefined, $$.value)",
      "attributes": "{ style : 'width: 100px'}",
      "dpos": {
        "colclass": "div-flex-col-embedded"
      }
    },    
    {
      "name": "dpos_ctrl",
      "parent": "layout_spec_ctrl",
      "type": "div",
      "_get": "$$('.parent')==0 || getContainerLayout($$) == 'dpos' ? [$$] : []",
      "attributes": "{ style: $$('.parent')==0 ? 'visibility: hidden':'', class : 'div-flex-row'}",
      "dpos": {
        "colclass": "div-flex-col-embedded-1"
      }
    },
    {
      "name": "dpos_colclass_l",
      "parent": "dpos_ctrl",
      "type": "label",
      "_get": "'Class:'",
      "dpos": {
        "colclass": "div-flex-col-embedded"
      }
    },
    {
      "name": "dpos_colclass",
      "parent": "dpos_ctrl",
      "type": "editbox",
      "_get": "$$('.dpos').colclass == undefined ? '' : $$('.dpos').colclass",
      "_set": "var v = _extend($$('.dpos'), {}); if(value) v.colclass=value; else delete v.colclass; $$.set('.dpos', v)",
      "attributes": "{ style : 'width: 100px'}",
      "dpos": {
        "colclass": "div-flex-col-embedded"
      }
    },
    {
      "name": "dpos_colstyle_l",
      "parent": "dpos_ctrl",
      "type": "label",
      "_get": "'Style:'",
      "dpos": {
        "colclass": "div-flex-col-embedded"
      }
    },
    {
      "name": "dpos_colstyl",
      "parent": "dpos_ctrl",
      "type": "editbox",
      "_get": "$$('.dpos').colstyle == undefined ? '' : $$('.dpos').colstyle",
      "_set": "var v = _extend($$('.dpos'), {}); if(value) v.colstyle=value; else delete v.colstyle; $$.set('.dpos', v)",
      "attributes": "{ style : 'width: 113px'}",
      "dpos": {
        "colclass": "div-flex-col-embedded"
      }
    }
  ]
}
