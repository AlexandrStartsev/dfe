<!DOCTYPE html>
<html>

    <head>
        <style>
            input[type='button'] {
                padding-top: 0px;
                padding-bottom: 0px;
            }        
        </style>
        
        <script src="/js/require.js"></script>
        
        <script> 
            var model = new Promise(function(resolve, reject) {
                require(['babel', 'uglify', 'ui/jquery' , 'redux', 'react', 'react-redux', 'react-dom'], function() {
                    window.babel = require('babel');
                    window.uglify = require('uglify');
                    window.Redux = require('redux');
                    window.React = require('react');
                    window.ReactRedux = require('react-redux');
                    window.Provider = ReactRedux.Provider;
                    window.ReactDOM = require('react-dom');
                    window.babel.transformScriptTags();
                    
                    //console.log(window.babel.transform("class ShoppingList extends React.Component { render() { let rows = ['Instagram', 'WhatsApp', 'Oculus'].map(v => <li>{v}</li>); return ( <div className='shopping-list'> <h1>Shopping List for {this.props.name}</h1><ul>{rows}</ul></div>);}}ReactDOM.render( <ShoppingList name='Mark' />, document.getElementById('react') );", {presets: ['es2015', 'react']}).code);
                    $.get('/test/test-arf-2.json', function(arf) { resolve(arf) })
                })
            });
            
            require.config({ baseUrl: '/js', paths: { forms : '../forms' } })
            zmodel = {value: 'x'}
            zmodel = {list : [
                {
                  name: 'Superman',
                  location: ''
                },
                {
                  name: 'Batman',
                  location: 'Wayne Manor'
                }
              ]};           
            require(['ui/utils']); 
        </script>     
        

    </head>
            
    <body> 
        <div id="react"></div>
        <script src="test/react-example-pure.jsx" type="text/jsx" data-presets="es2015,react">
          /*  const initialState = {
                name: "Mark",
                cart: [{key: 1, value: 'Instagram'}, {key: 2, value: 'WhatsApp'}, {key: 3, value: 'Oculus'}],
                key: 4
            };
            let rootReducer = (state = initialState, action) => {
                if(action.type == "ADD_ITEM")
                    return {cart: state.cart.concat({key: state.key, value: action.payload}), key: state.key+1, name: state.name};
                if(action.type == "MODIFY_ITEM") {
                    let newCart = state.cart.slice();
                    newCart[action.payload.pos] = Object.assign({}, newCart[action.payload.pos], {value: action.payload.value});
                    return { cart: newCart, key: state.key, name: state.name };
                }
                return state
            }
            let store = Redux.createStore(rootReducer);


            class EditableRow extends React.Component {
                constructor(props) {
                    super(props);
                    this.state = {
                        edit: false,
                        value: props.item.value,
                        originalValue: props.item.value
                    }
                }

                componentDidUpdate() {
                    this.input && this.input.focus();
                }

                closeInput(store) {
                    if(store) {
                        this.props.setValue(this.state.value);
                        this.setState({ edit: false, originalValue: this.state.value })
                    } else {
                        this.setState({ edit: false, value: this.state.originalValue })
                    }
                    this.input = null;
                }

                handleOnKeyDown(e) {
                    e.key == 'Enter' && this.closeInput(true);
                    e.key == 'Escape' && this.closeInput(false);
                    if(key.toString().match(/^\w$/)) {
                        this.setState({ value: this.input.value })
                        this.props.setValue(this.state.value);
                    }
                }

                render() {
                    return( 
                        <li onClick={e => this.setState({edit: true})}> { 
                                this.state.edit ? <input 
                                                      ref={e => this.input = e} 
                                                      defaultValue={ this.state.value } 
                                                      onChange={e => this.setState({value: e.target.value})}
                                                      onBlur={ this.closeInput.bind(this, true) }  
                                                      onKeyDown={e => this.handleOnKeyDown(e) }
                                                  /> : this.state.value } 
                        </li> )
                }
            }

            class ShoppingList extends React.Component {
                render() {
                    return (
                        <div className="shopping-list">
                            <h1>Shopping List for {this.props.name}</h1>
                            <ul>
                                <li>{this.props.cart[0].value}</li>
                                { 
                                this.props.cart.map((item, i) => {
                                    let mapStateToProps = state => ({ item: state.cart[i] })
                                    let mapDispatchToProps = dispatch => ({setValue: value => dispatch({ type: "MODIFY_ITEM", payload: { pos: i, value: value } })})
                                    return React.createElement(ReactRedux.connect(mapStateToProps, mapDispatchToProps)(EditableRow), {key: item.key})
                                })
                               }
                            </ul>
                            <button onClick={() => this.props.addNewRecord('New record') }>Add new record</button>
                        </div>
                    );
                }
            }

            class App extends React.Component {
                render() {
                    let mapStateToProps = state => ({ cart: state.cart, name: state.name })
                    let mapDispatchToProps = dispatch => ({addNewRecord: item => dispatch({ type: "ADD_ITEM", payload: item })})
                    return React.createElement( ReactRedux.connect(mapStateToProps, mapDispatchToProps)(ShoppingList) );
                }
            }
            
            ReactDOM.render( 
                <Provider store={store}>
                    <App />
                </Provider>, document.getElementById("react") );
        */
        </script>
        <!--<script src="test/react-example-1.jsx" type="text/jsx" data-presets="es2015,react"></script> -->
        
           
        <!--<img src="test/i1.svg#svg-icon-file-text"></div>
        <div id='dfe' dfe-form='quote.cmau.car' dfe-model='window.model' dfe-edit-target ></div>
        <br>
        <br>
        <br>
        
        <div id ="edit"></div>
        <script>
            setTimeout(function(){
                var node = document.getElementById('edit');
                node.setAttribute('dfe-form', 'dfe.edit.dfe');
                node.setAttribute('dfe-arguments', '(function(r){ return {params: {target_runtime: r}, model: r.form, listener: r.listener} })(document.querySelector("div[dfe-edit-target]")._dfe_runtime)');
            }, 1000) 
        </script> -->
    </body>
</html>