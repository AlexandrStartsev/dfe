<!DOCTYPE html>
<html>

    <head>
        <style>
            input[type='button'] {
                padding-top: 0px;
                padding-bottom: 0px;
            }
        </style>
        
        <script src="/js/require.js"></script>
        
        <script> 
            require.config({
                baseUrl: '/js', 
                paths: { 
                    //'dfe-core': 'es5', 'components/generic': 'es5', 'forms/corecomm/quote.cmau.car': 'es5',  
                    forms : '../forms' 
                }
            })
            var model = new Promise(function(resolve, reject) {
                require(['../test/test-100-cars', 'dfe-core', 'ui/utils' ], function(json, core) {
                    window.Core = core;
                    resolve(json);
                })
            });
            
            function getES5(doUglify) {
                require(['babel', 'uglify', 'ui/jquery'], function(babel, uglify) {
                    let formName = "forms/" + document.getElementById("dfe").getAttribute("dfe-form") + ".js"
                    Promise.all([$.get("js/dfe-core.js"), $.get("js/components/generic.js"), $.get(formName)]).then( // "transform-react-jsx",   , "react"
                    function(a) {
                        var s = babel.transform(a.join('\n\n\n'), {  plugins: [ "transform-object-rest-spread", "transform-object-assign"],  presets: ["es2015"] }).code;
                        if( doUglify ) {
                            s = uglify.parse(s); s.figure_out_scope(); s.compute_char_frequency(); s.mangle_names(); s = s.print_to_string({ ie8: true, max_line_len: 1000});
                        }
                        console.log(s);
                    });
                })
            }
            
                    /*$.get('/test/test-arf-2.json', function(arf) { 
                        //arf.policy[0].cmau[0].location.shift();
                        resolve(arf);
                        setTimeout(function() {
                            document.querySelector('[dfe-form]')._dfe_runtime.enforceValidation();
                        }, 1000);
                    })*/
            /*require(['ui/utils'], function() {
                require(['forms/corecomm/quote.cmau.car', 'dfe-core', 'ui/jquery'], function(form, core, $){
                    window.DfeCore = core;
                    $.get('/test/test-arf-2.json', function(arf) { 
                       // arf.policy[0].cmau[0].location[0].car.shift();
                        core.startRuntime({ model : arf, node: document.getElementById('dfe'), form: form });
                    })
                    
                    require(['babel'], function(babel) {
                        Promise.all([$.get("js/dfe-core.js"), $.get("js/components/generic.js"), $.get("forms/corecomm/quote.cmau.car.js")]).then( // "transform-react-jsx",   , "react"
                        function(a) {
                            var s = require('babel').transform(a.join('\n\n\n'), {  plugins: [ "transform-object-rest-spread", "transform-object-assign"],  presets: ["es2015"] }).code;
                            window.es5source = s;
                            //s = uglify.parse(s); s.figure_out_scope(); s.compute_char_frequency(); s.mangle_names(); s = s.print_to_string({ ie8: true, max_line_len: 1000});
                            //window.es5uglified = s;
                            //console.log(s);
                        });
                    })
                })
                
            });*/
        </script>     
        

    </head>
            
    <body> 
        <span id='dfe' dfe-form='corecomm/quote.cmau.car' dfe-model='window.model' dfe-edit-target ></span>
        <br>
        <br>
        <br>
        
        <div id ="edit"></div>
        <script>
            setTimeout(function(){
                var node = document.getElementById('edit');
                //node.setAttribute('dfe-form', 'dfe.edit.dfe');
                //node.setAttribute('dfe-arguments', '(function(r){ return {params: {target_runtime: r}, model: r.form, listener: r.listener} })(document.querySelector("div[dfe-edit-target]")._dfe_runtime)');
            }, 1000) 
        </script>
    </body>
</html>